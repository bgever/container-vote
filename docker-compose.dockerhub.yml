version: '3'

services:

  traefik:
    image: traefik
    command: -c /dev/null --api --docker --docker.domain=docker.localhost --logLevel=DEBUG
    ports:
    - "80:80"
    - "8080:8080"
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock
    labels:
    - "traefik.enable=false"
    
  web:
    image: "bgever/container-vote:web-latest"
    ports:
    - "80"
    restart: always
    labels:
    - "traefik.backend=web"
    - "traefik.frontend.rule=Host:localhost"
  
  api:
    image: "bgever/container-vote:api-latest"
    ports:
    - "80"
    restart: always
    labels:
    - "traefik.backend=api"
    - "traefik.frontend.rule=PathPrefix:/api/,Host:localhost"
    
  redis:
    image: "redis:alpine"
    restart: always
    labels:
    - "traefik.enable=false"